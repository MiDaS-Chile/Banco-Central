---
title: "Solución Actividades"
author: "MiDaS"
output: 
  prettydoc::html_pretty:
    theme: cayman

---

# Actividad I

## Problema 1

```{r}
impares <- seq(1, by = 2, length.out = 1000)
subset <- impares[c(1,10,100,1000)]
sum(sqrt(subset))
```

## Problema 2

Instalamos los siguientes paquetes: `babynames`, `nycflights13`, `maps` y los cargamos junto a `tidyverse`.

```{r,message = FALSE,warning = FALSE}

# Paquetes #
library(tidyverse)
library(babynames)
library(nycflights13)
library(maps)

# Datasets #
data("births")
data("nycflights13")
data("maps")
```

Considere la tabla `births` paquete `babynames`. 

(a) ¿Cuántas columnas y filas posee esta tabla?

(b) Utilizando un gráfico adecuado, estudie los nacimientos por años en EE.UU. ¿En qué década se obtuvo la menor cantidad de nacimientos?

### Solución

(a) Observemos el `glimpse` de la base de datos:

    ```{r}
    glimpse(births)

```

    Luego, hay 109 filas y 2 columnas.


(b) El siguiente código realiza el gráfico:

    ```{r}
ggplot(data = births) +
  geom_line(aes(x = year, y = births, col = "darkblue")) + 
      theme(plot.subtitle = element_text(vjust = 1), 
            plot.caption = element_text(vjust = 1), 
            axis.line = element_line(linetype = "solid"), 
            panel.grid.major = element_line(linetype = "blank"), 
            axis.text = element_text(size = 12), 
            axis.text.x = element_text(size = 12), 
            panel.background = element_rect(fill = NA, linetype = "solid"), 
            legend.key = element_rect(fill = "white"), 
            legend.background = element_rect(fill = NA, linetype = "solid"))
```

    Ahora bien, para obtener la década con menor nacimientos consideramos el siguiente código:
    
    ```{r}
  births %>%
    filter(year >= 1910) %>% 
    mutate(decade = floor(year/10)*10) %>% 
    group_by(decade) %>% 
    summarise(nacimientos = sum(births)) %>%
    filter(nacimientos == min(nacimientos))
```
    
    Por lo tanto, la década con menos nacimientos es la década del 30.
    
---

## Problema 3

Considere ahora la tabla `babynames` del paquete `babynames`. 

(a) Realice el proceso necesario para obtener la misma estructura en cuanto a **columnas** que la tabla `births`, esto es, generar una nueva tabla que nos entregue el número de nacimientos por año.

(b) Genere un data frame partiendo de la tabla `babynames` que contenga los nacimientos de las personas de género femenino con el nombre **Nala, Ariel** y **Elsa** desde los años 1980.

(c) Con el data frame obtenido en la parte anterior, genere un gráfico que contenga la información de los nacimientos por año de cada uno de los nombres mencionados y mencionte una hipótesis/suposición al respecto de lo observado. *Hint:* Use `face_wrap(~ name, scales = "free_y")`.

### Solución

(a) El siguiente código realiza lo pedido:

    ```{r}
babynames %>% 
    group_by(year) %>% 
    summarise(births = n() ) -> births2
  head(births2)
```

(b) El siguiente código realiza lo pedido:

    ```{r}
babynames %>%
    filter(sex == "F", year >= 1980, name %in% c("Nala","Ariel","Elsa")) %>% 
    arrange(name) -> births3
  head(births3)
```

(c) El siguiente código resulta en el gráfico pedido

    ```{r}
ggplot(data = births3) + 
   geom_line(aes(x = year, y = n)) +
   facet_wrap( ~ name, ncol = 3, nrow = 1, scales = "free_y")
```


## Problema 4

(a) Utilizando las tablas `airports` y `flights` del paquete `nycflights13` obtenga una tabla que contenga conteos de vuelos según su destino `dest` además de la longitud y latitud del aeropuerto(de destino).

(b) Apoyándose del siguiente gráfico:

    ```{r,message = FALSE}
library(maps)
us <- map_data("state")

ggmap <- ggplot() +
  geom_polygon(data = us, aes(long, lat, group = group), alpha = 0.25) +
  coord_fixed() # esto es para mantener la razón 1:1

ggmap
    ```
    
    1. Agregue una capa de puntos ubicando los aeropuertos obtenidos de la pregunta anterior y usando además: `aes(size = la_cantidad_de_vuelos_a_dicho_aeropuerto)`.

    2. A la izquierda del gráfico anterior se observan 2 puntos. Genere el/los pasos necesarios para seleccionarlos usando la tabla resultante de la pregunta 5 para identificar los nombres de dichos aeropuertos y responda: ¿Donde están? ¿Qué gracias tienen?
    
### Solución

(a) El siguiente código obtiene lo pedido:

    ```{r}
  flights %>% 
    left_join(airports, by = c("dest" = "faa")) %>% 
    group_by(name) %>% 
    summarise(nvuelos = n()) %>% 
    left_join(airports, by = "name") %>% 
    select(name,lat,lon,nvuelos) -> airports2
  head(airports2)
```

(b) El siguiente código obtiene lo pedido:

    ```{r, warning = FALSE}
ggmap <- ggplot() +
    geom_polygon(data = us, aes(long, lat, group = group), alpha = 0.25) + 
    coord_fixed()

  ggmap + 
    geom_point(data = airports2, 
               aes(x = lon, y = lat, size = nvuelos, color = "darkblue"), 
               alpha = 0.7)

  airports2 %>% 
    filter(lon < -130)
```

## Actividad II


Cree dos funciones para γ(s,x), la primera utilizando la definción y la segunda utilizando su representación en series de potencia. Las funciones no se deben ejecutar si el argumento s es negativo y un mensaje debe ser entregado al usuario.


```{r }
gam1<- function(s,x){
  if(s < 0) stop("s debe ser positivo")
  myf<-function(t){
    t^(s-1)*exp(-t)
  }
  integrate(myf,0,x)$value
}

gam2<- function(s,x){
  if(s < 0) stop("s debe ser positivo")
  k<-0
  aux<-0
  while (!is.infinite(gamma(s+k+1))){
    aux=sum(x^(0:k)/gamma(s+0:k+1))
    k<-k+1
  }
  ifelse(is.infinite(aux),gamma(s),x^s*gamma(s)*exp(-x)*aux)
}
```


Considere el siguiente conjunto de argumentos :$$(s,x)\in {(2,5);(2,20);(10,2);(10,20)}$$.
Evalue las funciones creadas anteriormente y la función `Igamma()` del paquete `zipfR`, y compare los resultados. Además, calcule y compare el tiempo de ejecución.



```{r}
library(zipfR)
library(microbenchmark)
data.frame(Argumentos=c('(2,5)','(2,20)','(10,2)','(10,20)'),gam1=c(gam1(2,5),gam1(2,20),gam1(10,2),gam1(10,20)),gam2=c(gam2(2,5),gam2(2,20),gam2(10,2),gam2(10,20)),Igamma=c(Igamma(2,5),Igamma(2,20),Igamma(10,2),Igamma(10,20)))
```

```{r}
microbenchmark(times = 100, unit = "s", gam1(2,5), gam2(2,5), Igamma(2,3))
microbenchmark(times = 100, unit = "s", gam1(2,20), gam2(2,20), Igamma(2,20))
microbenchmark(times = 100, unit = "s", gam1(10,2), gam2(10,2), Igamma(10,2))
microbenchmark(times = 100, unit = "s", gam1(10,20), gam2(10,20), Igamma(10,20))
```

Utilizando las funciones anteriormente implementadas y la función `Igamma()` encuentre el valor de $s$ que minimiza $\gamma(s,x)$ cuando $x=2$, $x=3$, $x=5$ y $x=100$. Compare los resultados y el tiempo de ejecución.

```{r}
data.frame(x=c(2,3,5,100),gam1=c(optimize(gam1,lower=0,upper=4,x=2)$minimum,optimize(gam1,lower=0,upper=4,x=3)$minimum,optimize(gam1,lower=0,upper=4,x=5)$minimum,optimize(gam1,lower=0,upper=4,x=100)$minimum),gam2=c(optimize(gam2,lower=0,upper=4,x=2)$minimum,optimize(gam2,lower=0,upper=4,x=3)$minimum,optimize(gam2,lower=0,upper=4,x=5)$minimum,optimize(gam2,lower=0,upper=4,x=100)$minimum),Igamma=c(optimize(Igamma,lower=0,upper=4,x=2)$minimum,optimize(Igamma,lower=0,upper=4,x=3)$minimum,optimize(Igamma,lower=0,upper=4,x=5)$minimum,optimize(Igamma,lower=0,upper=4,x=100)$minimum))
```

```{r}
microbenchmark(times = 100, unit = "s", optimize(gam1,lower=0,upper=4,x=2), optimize(gam2,lower=0,upper=4,x=2), optimize(Igamma,lower=0,upper=4,x=2))
microbenchmark(times = 100, unit = "s", optimize(gam1,lower=0,upper=4,x=3), optimize(gam2,lower=0,upper=4,x=3), optimize(Igamma,lower=0,upper=4,x=3))
microbenchmark(times = 100, unit = "s", optimize(gam1,lower=0,upper=4,x=5), optimize(gam2,lower=0,upper=4,x=5), optimize(Igamma,lower=0,upper=4,x=5))
microbenchmark(times = 100, unit = "s", optimize(gam1,lower=0,upper=4,x=100), optimize(gam2,lower=0,upper=4,x=100), optimize(Igamma,lower=0,upper=4,x=100))
```

## Actividad III

## Actividad IV